{%- liquid
  comment
    Check if section should be hidden based on customer type
  endcomment

  assign show_section = true
  assign customer_type = 'logged_out'

  if customer
    assign customer_type = 'diy'
    for tag in customer.tags
      if tag == 'hubpro-free'
        assign customer_type = 'hubpro-free'
        break
      elsif tag == 'hubpro-plus'
        assign customer_type = 'hubpro-plus'
        break
      endif
    endfor
  endif

  comment
    Check visibility settings for this customer type
  endcomment

  case customer_type
    when 'hubpro-free'
      unless section.settings.show_for_hubpro_free
        assign show_section = false
      endunless
    when 'hubpro-plus'
      unless section.settings.show_for_hubpro_plus
        assign show_section = false
      endunless
    when 'diy'
      unless section.settings.show_for_diy
        assign show_section = false
      endunless
    when 'logged_out'
      unless section.settings.show_for_logged_out
        assign show_section = false
      endunless
  endcase
-%}

{%- if show_section -%}
  <style>
    #shopify-section-{{ section.id }} {
      --section-padding-top: {{ section.settings.padding_top }}px;
      --section-padding-bottom: {{ section.settings.padding_bottom }}px;
      {%- render 'section-variables', section: section -%}
    }
  </style>

  <div class="section section--padding{% if section.settings.divider %} section--divider{% endif %}{% if section.settings.rounded %} section--rounded relative{% endif %}">
    <div class="page-width{% if section.settings.narrow %} page-width--narrow{% endif %} relative">
      {{ section.settings.liquid }}

      {%- comment -%} Support for theme blocks {%- endcomment -%}
      {%- for block in section.blocks -%}
        {%- render block -%}
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.custom-liquid.name",
  "settings": [
    {
      "type": "liquid",
      "id": "liquid",
      "label": "t:sections.custom-liquid.settings.liquid.label",
      "info": "t:sections.custom-liquid.settings.liquid.info"
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__colors.content",
      "info": "t:sections.global.settings.header__colors.info"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "t:sections.global.settings.color_text.label"
    },
    {
      "type": "color",
      "id": "color_background",
      "label": "t:sections.global.settings.color_background.label"
    },
    {
      "type": "color_background",
      "id": "gradient_background",
      "label": "t:sections.global.settings.gradient_background.label"
    },
    {
      "type": "color",
      "id": "color_button_text",
      "label": "t:sections.global.settings.color_button_text.label"
    },
    {
      "type": "color",
      "id": "color_button_background",
      "label": "t:sections.global.settings.color_button_background.label"
    },
    {
      "type": "color_background",
      "id": "color_button_gradient",
      "label": "t:sections.global.settings.color_button_gradient.label"
    },
    {
      "type": "header",
      "content": "User Type Visibility"
    },
    {
      "type": "checkbox",
      "id": "show_for_logged_out",
      "label": "Show for Logged Out Users",
      "info": "Show this section for visitors who are not logged in",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_for_diy",
      "label": "Show for DIY Users",
      "info": "Show this section for logged in customers without HubPro tags",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_for_hubpro_free",
      "label": "Show for HubPro Free Users",
      "info": "Show this section for customers with hubpro-free tag",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_for_hubpro_plus",
      "label": "Show for HubPro Plus Users",
      "info": "Show this section for customers with hubpro-plus tag",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.global.settings.header__section.content"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.global.settings.padding_top.label",
      "default": 72
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "t:sections.global.settings.padding_bottom.label",
      "default": 72
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "t:sections.global.settings.divider.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "narrow",
      "label": "t:sections.global.settings.narrow.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "rounded",
      "default": false,
      "label": "t:sections.global.settings.rounded.label"
    }
  ],
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    }
  ],
  "presets": [
    {
      "name": "t:sections.custom-liquid.name"
    }
  ],
  "disabled_on": {
    "groups": ["custom.overlay"]
  }
}
{% endschema %}
