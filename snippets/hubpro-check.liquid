{%- doc -%}
  Global HubPro customer tag checker
  
  Checks if the current customer has 'hubpro-free' or 'hubpro-plus' tags
  and sets variables for conditional styling and logo display.
  
  Usage: {% render 'hubpro-check' %}
  
  Sets global variables:
  - is_hubpro_user: boolean (true if user has any HubPro tag)
  - hubpro_tier: string ('free', 'plus', or empty)
  - hubpro_nav_color: string (navigation color for HubPro users)
  - hubpro_logo: image object (HubPro-specific logo if configured)
{%- enddoc -%}

{%- liquid
  # Initialize HubPro variables
  assign is_hubpro_user = false
  assign hubpro_tier = ''
  assign hubpro_nav_color = ''
  assign hubpro_logo = blank
  assign hubpro_logo_mobile = blank

  # Check if customer is logged in and has tags
  if customer and customer.tags.size > 0
    # Check for HubPro tags
    for tag in customer.tags
      assign tag_downcase = tag | downcase

      if tag_downcase == 'hubpro-free'
        assign is_hubpro_user = true
        assign hubpro_tier = 'free'
        break
      elsif tag_downcase == 'hubpro-plus'
        assign is_hubpro_user = true
        assign hubpro_tier = 'plus'
        break
      endif
    endfor
  endif

  # Set HubPro-specific values if user is a HubPro member
  if is_hubpro_user
    # Set navigation color (default to #424242 as requested, but allow customization)
    assign hubpro_nav_color = settings.hubpro_nav_color | default: '#424242'

    # Set desktop logo based on tier (prefer tier-specific logo, fallback to general HubPro logo)
    if hubpro_tier == 'plus' and settings.hubpro_plus_logo != blank
      assign hubpro_logo = settings.hubpro_plus_logo
    elsif hubpro_tier == 'free' and settings.hubpro_free_logo != blank
      assign hubpro_logo = settings.hubpro_free_logo
    elsif settings.hubpro_logo != blank
      assign hubpro_logo = settings.hubpro_logo
    endif

    # Set mobile logo based on tier (prefer tier-specific logo, fallback to general HubPro logo, then desktop logo)
    if hubpro_tier == 'plus' and settings.hubpro_plus_logo_mobile != blank
      assign hubpro_logo_mobile = settings.hubpro_plus_logo_mobile
    elsif hubpro_tier == 'free' and settings.hubpro_free_logo_mobile != blank
      assign hubpro_logo_mobile = settings.hubpro_free_logo_mobile
    elsif settings.hubpro_logo_mobile != blank
      assign hubpro_logo_mobile = settings.hubpro_logo_mobile
    else
      assign hubpro_logo_mobile = hubpro_logo
    endif
  endif
-%}

{%- comment -%}
  Debug output for development - remove in production if not needed
{%- endcomment -%}
{%- if request.design_mode -%}
  <script>
    console.log('üè∑Ô∏è HubPro Check Debug:', {
      customer: {{ customer.id | default: 'not logged in' | json }},
      tags: {{ customer.tags | json }},
      isHubProUser: {{ is_hubpro_user | json }},
      hubproTier: {{ hubpro_tier | json }},
      hubproNavColor: {{ hubpro_nav_color | json }},
      hubproLogo: {{ hubpro_logo.alt | default: 'not set' | json }}
    });
  </script>
{%- endif -%}
