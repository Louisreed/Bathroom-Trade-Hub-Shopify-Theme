{% comment %}This snippet is generated and updated by aaa Memberships. any changes will be overridden when the Store Owner saves a Plan in the app.{% endcomment %}

{% assign aaa_membership_partial_redirect = false %}
{% assign aaa_membership_full_redirect = false %}
{% assign mem_current_template = template %}

{% if aaa_membership_partial_redirect == true %}
  <script>
    if (window.checkoutDebug) {
      checkoutDebug.log('üîç AAA partial redirect triggered');
      checkoutDebug.log('Current path:', window.location.pathname);
    }
    // CRITICAL FIX: Prevent redirects during checkout process
    if (window.location.pathname !== '/checkout' && !window.location.pathname.includes('/orders/')) {
      if (window.checkoutDebug) checkoutDebug.log('üö® AAA partial redirect executing');
      top.location = window.location.href + '?view={{aaa_membership_template}}';
    } else {
      if (window.checkoutDebug) checkoutDebug.log('‚úÖ AAA partial redirect blocked (checkout page)');
    }
  </script>
{% endif %}

{% if aaa_membership_full_redirect == true %}
  <script>
    if (window.checkoutDebug) {
      checkoutDebug.log('üîç AAA full redirect triggered');
      checkoutDebug.log('Current path:', window.location.pathname);
    }
    // CRITICAL FIX: Prevent redirects during checkout process
    if (window.location.pathname !== '/checkout' && !window.location.pathname.includes('/orders/')) {
      aaa_url = window.location.href;
      var targetUrl = aaa_url.split('?view=')[0];
      if (window.checkoutDebug) checkoutDebug.log('üö® AAA full redirect executing to:', targetUrl);
      top.location = targetUrl;
    } else {
      if (window.checkoutDebug) checkoutDebug.log('‚úÖ AAA full redirect blocked (checkout page)');
    }
  </script>
{% endif %}
